/*! Mao by Adam Timberlake created on 2013-09-18 */
!function(a){"use strict";a.mao=angular.module("maoApp",[]),a.mao.config(["$routeProvider","$provide","$locationProvider",function(a,b,c){a.when("/",{templateUrl:"views/home.html"}).when("/category/:first",{templateUrl:"views/category.html"}).when("/category/:first/:second",{templateUrl:"views/category.html",reloadOnSearch:!1}).when("/category/:first/:second/:third",{templateUrl:"views/category.html"}).when("/product/:ident",{templateUrl:"views/product.html"}).otherwise({redirectTo:"/error/not-found"}),c.html5Mode(!1).hashPrefix("!")}]),a.mao.value("$anchorScroll",angular.noop),a.mao.run(function(a,b){a.$on("$routeChangeSuccess",function(){return b.product?(a.$broadcast("mao/product/loaded",b.product),void 0):(a.$broadcast("mao/product/unloaded"),void 0)})})}(window),function(a){"use strict";a.factory("$attributeHelper",["$rootScope","$http","$q",function(a,b,c){var d={};d.manufacturers={url:"/Magento-on-Angular/api/public/attributes/manufacturer",defer:c.defer(),cache:[],inactive:[]},d.colours={url:"/Magento-on-Angular/api/public/attributes/color",defer:c.defer(),cache:[],inactive:[]},d.request=function f(a,c,d){var f=b({method:"GET",url:a});f.success(function(a){d(a),c.resolve(a)})},a.$on("mao/products/updated",function(a,b){d.hasLoaded("colours").then(function(){d.colours.cache.forEach(function(a){a._meta.modelCount=b.filter(function(b){return b.colour===a.id}).length})}),d.hasLoaded("manufacturers").then(function(){d.manufacturers.cache.forEach(function(a){a._meta.modelCount=b.filter(function(b){return b.manufacturer===a.id}).length})})});var e=function(a,b){a.forEach(function(a){a._meta={};for(var c in b)b.hasOwnProperty(c)&&(a._meta[c]=b[c])})};return d.request(d.colours.url,d.colours.defer,function(a){e(a,{type:"colours",active:!1,modelCount:0}),d.colours.cache=a}),d.request(d.manufacturers.url,d.manufacturers.defer,function(a){e(a,{type:"manufacturers",active:!1,modelCount:0}),d.manufacturers.cache=a}),d.getColours=function(){return d.colours.cache},d.getManufacturers=function(){return d.manufacturers.cache},d.hasLoaded=function(a){return d[a].defer.promise},d.toggle=function(b){var c=d[b._meta.type],e=c.inactive.indexOf(b.id),f=-1!==e;return f?(c.inactive.splice(e,1),b._meta.active=!1):(c.inactive.push(b.id),b._meta.active=!0),a.$broadcast("mao/attribute/updated",b._meta.type,c.inactive),!0},d}])}(window.mao,window.jQuery),function(a){"use strict";a.factory("$categoryHelper",["$rootScope","$q",function(a,b){var c={},d=b.defer();return c.hasLoaded=function(){return d.promise},c.find=function(a,b){var d=c.categories.filter(function(b){return b.ident===a})[0];if(b)var e=d.children.filter(function(a){return a.ident===b})[0];return{category:d,subCategory:e}},a.$on("loadedCategories",function(a,b){c.categories=b,d.resolve()}),c}])}(window.mao,window.jQuery),function(a,b,c){"use strict";a.factory("$crossfilterHelper",["$rootScope",function(){var a={};return a.crossfilter={},a.simple={crossfilter:{},dimensions:{}},a.dimensions=[],a.create=function(b){return a.simple.crossfilter=c(b),a.simple.dimensions.id=a.simple.crossfilter.dimension(function(a){return a.id}),a.simple.dimensions.ident=a.simple.crossfilter.dimension(function(a){return a.ident}),a.crossfilter=c(b)},a.addDimension=function(b,c){return a.dimensions[b]=a.crossfilter.dimension(function(a){return a[c]})},a.get=function(b){return a.dimensions[b]},a.getBy=function(c,d){a.simple.dimensions.id.filterAll(),a.simple.dimensions.ident.filterAll();var e=a.simple.dimensions[c];return Array.isArray(d)?(e.filterFunction(function(a){return-1!==b.inArray(a,d)}),e.top(1/0)):(e.filterExact(d),e.top(1)[0])},a}])}(window.mao,window.jQuery,window.crossfilter),function(a){"use strict";a.factory("$parameters",["$rootScope","$routeParams",function(a,b){var c={};return c.parse=function(){c.category=b.first,c.pageNumber=b.second||1,c.product=b.third},a.$on("$routeChangeSuccess",c.parse),c}])}(window.mao,window.jQuery),function(a,b){"use strict";a.factory("$productHelper",["$rootScope","$crossfilterHelper","$http","$q",function(a,c,d,e){var f="name",g={};g.products=[],g.loaded=!1,g.records=[];var h=d({method:"GET",url:"/Magento-on-Angular/api/public/products"}),i=e.defer();h.success(function(b){c.create(b),c.addDimension("id","id"),c.addDimension("name","name"),c.addDimension("price","price"),c.addDimension("categories","categories"),c.addDimension("colours","colour"),c.addDimension("manufacturers","manufacturer"),g.records.price={top:c.get("price").top(1)[0],bottom:c.get("price").bottom(1)[0]},i.resolve(),g.loaded=!0,a.$broadcast("mao/products/loaded")}),a.$on("mao/attribute/updated",function(d,e,f){var h=c.get(e);h.filterFunction(function(a){return-1===b.inArray(a,f)}),a.$broadcast("mao/products/updated",g.getProducts())}),g.record=function(a,b){return g.records[a]?g.records[a][b][a]:0},g.sortBy=function(b){return f=b,a.$broadcast("mao/products/updated",g.getProducts()),!0},g.hasLoaded=function(){return i.promise},g.getProducts=function(){return c.get(f).top(1/0).reverse()};var j=function(b,d){var e=c.get(b);e&&(d.apply(e),a.$broadcast("mao/products/updated",g.getProducts()))};return g.setQuery=function(a){if(!a)return j("name",function(){this.filterAll()}),void 0;var b=new RegExp(a,"i");j("name",function(){this.filterFunction(function(a){return a.match(b)})})},g.setCategoryId=function(a){j("categories",function(){this.filterFunction(function(c){return-1!==b.inArray(a,c)})})},g.setPriceRange=function(a,b){j("price",function(){this.filterRange([a,b])})},g.pluckBy=function(a,b){return c.getBy(a,b)},g}])}(window.mao,window.jQuery),function(a){"use strict";a.controller("ApplicationController",["$scope",function(a){a.lostFocus=!1,a.$on("mao/product/loaded",function(){a.lostFocus=!0}),a.$on("mao/product/unloaded",function(){a.lostFocus=!1})}])}(window.mao),function(a){"use strict";a.controller("BasketController",["$rootScope","$scope","$http","$productHelper",function(a,b,c,d){b.items=[];var e=c({method:"GET",url:"/Magento-on-Angular/api/public/basket"});e.success(function(c){var e=_.map(c,function(a){return a.id});d.hasLoaded().then(function(){b.items=d.pluckBy("id",e),a.$emit("mao/basket/loaded",b.items)})}),b.$on("mao/basket/add",function(e,f){var g=c({method:"GET",url:"/Magento-on-Angular/api/public/basket/add/"+f});g.success(function(){var c=d.pluckBy("id",f);a.$broadcast("mao/basket/updated",c),b.items.push(c)})})}])}(window.mao),function(a){"use strict";a.controller("CategoriesController",["$scope","$http",function(a,b){a.categories=[];var c=b({method:"GET",url:"/Magento-on-Angular/api/public/categories"});c.success(function(b){a.categories=b,a.$emit("loadedCategories",b)})}])}(window.mao),function(a){"use strict";a.controller("CategoryController",["$rootScope","$scope","$categoryHelper","$productHelper","$attributeHelper","$parameters",function(a,b,c,d,e,f){b.products=[],b.colours=[],b.manufacturers=[],b.query="",b.manufacturersFilter="",b.toggle=e.toggle,b.sortBy=d.sortBy,b.setPriceRange=d.setPriceRange,b.currentPage=f.pageNumber,b.pages=[],b.perPage=10,b.maximumPrice=d.record("price","top"),b.minimumPrice=d.record("price","bottom"),b.selectionProductCount=0,b.totalProductCount=0,b.paginateProducts=function(){var a=d.getProducts();b.pages=_.range(1,a.length/b.perPage+1);var c=b.currentPage*b.perPage-b.perPage;return a.slice(c,c+b.perPage)},b.$on("mao/products/updated",function(a,c){b.selectionProductCount=c.length,b.products=b.paginateProducts(c)}),b.$on("mao/products/loaded",function(){b.minimumPrice=d.record("price","bottom"),b.maximumPrice=d.record("price","top")}),b.$watch("query",function(){d.setQuery(b.query)}),c.hasLoaded().then(function(){var a=f.subCategory||null,g=c.find(f.category,a);b.totalProductCount=g.category.productCount,b.category=g.category,b.subCategory=g.subCategory;var h=b.subCategory?b.subCategory.id:b.category.id;d.hasLoaded().then(function(){d.setCategoryId(h),b.products=b.paginateProducts()}),e.hasLoaded("colours").then(function(){b.colours=e.getColours()}),e.hasLoaded("manufacturers").then(function(){b.manufacturers=e.getManufacturers()})})}])}(window.mao),function(a){"use strict";a.controller("HomeController",function(){})}(window.mao),function(a){"use strict";a.controller("ProductController",["$scope","$http","$parameters","$productHelper","$window","$location","$rootScope","$timeout",function(a,b,c,d,e,f,g,h){a.product=null,a.adding=!1,a.recentlyAdded=!1,a.dismiss=function(){f.search("product",null)},a.$on("mao/product/loaded",function(c,e){d.hasLoaded().then(function(){a.product=d.pluckBy("ident",e);var c="/Magento-on-Angular/api/public/product/"+a.product.id,f=b({method:"GET",url:c});f.success(function(b){a.product=_.extend(a.product,b)})})}),a.$on("mao/product/unloaded",function(){a.product=null}),a.$on("mao/product/unload",function(){a.dismiss()}),a.$on("mao/basket/updated",function(){a.adding=!1,a.recentlyAdded=!0,h(function(){a.recentlyAdded=!1},5e3)}),a.addBasket=function(b){a.adding=!0,g.$broadcast("mao/basket/add",b)}}])}(window.mao);