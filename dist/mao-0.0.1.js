/*! Mao by Adam Timberlake created on 2013-09-04 */
!function(a){"use strict";a.mao=angular.module("maoApp",[]).config(["$routeProvider","$provide","$locationProvider",function(a,b,c){a.when("/",{templateUrl:"views/home.html"}).when("/category/:category",{templateUrl:"views/category.html"}).when("/category/:category/:subCategory",{templateUrl:"views/category.html"}).when("/category/:category/:subCategory/:pageNumber",{templateUrl:"views/category.html"}).when("/products",{templateUrl:"views/products.html"}).otherwise({redirectTo:"/error/not-found"}),c.html5Mode(!1).hashPrefix("!")}])}(window),function(a,b){"use strict";a.factory("$categoryHelper",["$rootScope",function(a){var c={},d=b.Deferred();return c.hasLoaded=function(){return d.promise()},c.find=function(a,b){var d=c.categories.filter(function(b){return b.ident===a})[0];if(b)var e=d.children.filter(function(a){return a.ident===b})[0];return{category:d,subCategory:e}},a.$on("loadedCategories",function(a,b){c.categories=b,d.resolve()}),c}])}(window.mao,window.jQuery),function(a){"use strict";a.factory("$crossfilterHelper",["$rootScope",function(){var a={};return a.crossfilter={},a.dimensions=[],a.create=function(b){return a.crossfilter=crossfilter(b)},a.addDimension=function(b){return a.dimensions[b]=a.crossfilter.dimension(function(a){return a[b]})},a.get=function(b){return a.dimensions[b]},a}])}(window.mao,window.jQuery,window.crossfilter),function(a,b){"use strict";a.factory("$productHelper",["$rootScope","$http","$crossfilterHelper",function(a,c,d){var e={},f=c({method:"GET",url:"/Magento-on-Angular/api/public/products"}),g=b.Deferred();return f.success(function(a){var b=d.create(a);d.addDimension("id"),d.addDimension("categories"),e.products=b,g.resolve()}),e.hasLoaded=function(){return g.promise()},e.fetch=function(){return d.get("id").top(1/0)},e.setCategoryId=function(a){var c=d.get("categories");c.filterAll(),c.filterFunction(function(c){return-1!==b.inArray(a,c)})},e}])}(window.mao,window.jQuery),function(a){"use strict";a.controller("CategoriesController",["$scope","$http",function(a,b){a.categories=[];var c=b({method:"GET",url:"/Magento-on-Angular/api/public/categories"});c.success(function(b){a.categories=b,a.$emit("loadedCategories",b)})}])}(window.mao),function(a){"use strict";a.controller("CategoryController",["$rootScope","$scope","$routeParams","$categoryHelper",function(a,b,c,d){d.hasLoaded().then(function(){var a=c.subCategory||null,e=d.find(c.category,a);b.category=e.category,b.subCategory=e.subCategory;var f=b.subCategory?b.subCategory.id:b.category.id;b.$watch("$viewContentLoaded",function(){b.$broadcast("switchedCategory",f)})})}])}(window.mao),function(a){"use strict";a.controller("HomeController",function(){})}(window.mao),function(a){"use strict";a.controller("ProductsController",["$rootScope","$scope","$http","$productHelper","$routeParams",function(a,b,c,d,e){b._getPageNumber=function(a){if(!a.pageNumber&&!a.subCategory)return 1;if(a.pageNumber)return a.pageNumber;var b=1,c=a.subCategory&&a.subCategory.match(/^\d+$/);return c&&(b=a.subCategory,delete a.subCategory),b},b.products=[],b.perPage=10,b.currentPage=b._getPageNumber(e),b.pagination=[],b.hasLoaded=!1,b.pages=[],b.$on("switchedCategory",function(a,c){d.hasLoaded().then(function(){d.setCategoryId(c);var a=b.currentPage*b.perPage-b.perPage,e=d.fetch(),f=Math.ceil(e.length/b.perPage);b.products=e.slice(a,b.perPage+a),b.hasLoaded=!0;for(var g=0;f>g;g++)b.pages[g]=g+1})})}])}(window.mao);