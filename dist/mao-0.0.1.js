/*! Mao by Adam Timberlake created on 2013-09-05 */
!function(a){"use strict";a.mao=angular.module("maoApp",[]).config(["$routeProvider","$provide","$locationProvider",function(a,b,c){a.when("/",{templateUrl:"views/home.html"}).when("/category/:category",{templateUrl:"views/category.html"}).when("/category/:category/:subCategory",{templateUrl:"views/category.html"}).when("/category/:category/:subCategory/:pageNumber",{templateUrl:"views/category.html"}).when("/products",{templateUrl:"views/products.html"}).otherwise({redirectTo:"/error/not-found"}),c.html5Mode(!1).hashPrefix("!")}])}(window),function(a){"use strict";a.factory("$attributeHelper",["$http","$q",function(a,b){var c={};return c.promises={colours:b.defer(),manufacturers:b.defer()},c.request=function(b,c){var d=a({method:"GET",url:b});d.success(function(a){c.resolve(a)})},c.request("/Magento-on-Angular/api/public/attributes/color",c.promises.colours),c.request("/Magento-on-Angular/api/public/attributes/manufacturer",c.promises.manufacturers),c.hasLoaded=function(a){return c.promises[a].promise},c}])}(window.mao,window.jQuery),function(a){"use strict";a.factory("$categoryHelper",["$rootScope","$q",function(a,b){var c={},d=b.defer();return c.hasLoaded=function(){return d.promise},c.find=function(a,b){var d=c.categories.filter(function(b){return b.ident===a})[0];if(b)var e=d.children.filter(function(a){return a.ident===b})[0];return{category:d,subCategory:e}},a.$on("loadedCategories",function(a,b){c.categories=b,d.resolve()}),c}])}(window.mao,window.jQuery),function(a){"use strict";a.factory("$crossfilterHelper",["$rootScope",function(){var a={};return a.crossfilter={},a.dimensions=[],a.create=function(b){return a.crossfilter=crossfilter(b)},a.addDimension=function(b){return a.dimensions[b]=a.crossfilter.dimension(function(a){return a[b]})},a.get=function(b){return a.dimensions[b]},a}])}(window.mao,window.jQuery,window.crossfilter),function(a,b){"use strict";a.factory("$productHelper",["$rootScope","$http","$q","$crossfilterHelper",function(a,c,d,e){var f={};f.colour=[],f.manufacturer=[];var g=c({method:"GET",url:"/Magento-on-Angular/api/public/products"}),h=d.defer();return g.success(function(a){var b=e.create(a);e.addDimension("id"),e.addDimension("categories"),e.addDimension("colour"),e.addDimension("manufacturer"),f.products=b,h.resolve()}),f.hasLoaded=function(){return h.promise},f.fetch=function(){return e.get("id").top(1/0)},f.setCategoryId=function(c){var d=e.get("categories");d.filterAll(),d.filterFunction(function(a){return-1!==b.inArray(c,a)}),a.$broadcast("contentUpdated")},f.addRemoveById=function(c,d){var g=f[c],h=g.indexOf(d);-1!==h?g.splice(h,1):g.push(d);var i=e.get(c);i.filterFunction(function(a){return-1===b.inArray(a,g)}),a.$broadcast("contentUpdated")},f}])}(window.mao,window.jQuery),function(a){"use strict";a.controller("AttributesController",["$rootScope","$scope","$routeParams","$attributeHelper",function(a,b,c,d){b.colours=[],b.manufacturers=[],d.hasLoaded("colours").then(function(a){b.colours=a}),d.hasLoaded("manufacturers").then(function(a){b.manufacturers=a})}])}(window.mao),function(a){"use strict";a.controller("CategoriesController",["$scope","$http",function(a,b){a.categories=[];var c=b({method:"GET",url:"/Magento-on-Angular/api/public/categories"});c.success(function(b){a.categories=b,a.$emit("loadedCategories",b)})}])}(window.mao),function(a){"use strict";a.controller("CategoryController",["$rootScope","$scope","$routeParams","$categoryHelper",function(a,b,c,d){b.manufacturer="",d.hasLoaded().then(function(){var a=c.subCategory||null,e=d.find(c.category,a);b.category=e.category,b.subCategory=e.subCategory;var f=b.subCategory?b.subCategory.id:b.category.id;b.$watch("$viewContentLoaded",function(){b.$broadcast("switchedCategory",f)})})}])}(window.mao),function(a){"use strict";a.controller("HomeController",function(){})}(window.mao),function(a){"use strict";a.controller("ProductsController",["$rootScope","$scope","$http","$productHelper","$routeParams",function(a,b,c,d,e){b._getPageNumber=function(a){if(!a.pageNumber&&!a.subCategory)return 1;if(a.pageNumber)return a.pageNumber;var b=1,c=a.subCategory&&a.subCategory.match(/^\d+$/);return c&&(b=a.subCategory,delete a.subCategory),b},b.products=[],b.productCount=0,b.perPage=10,b.currentPage=b._getPageNumber(e),b.pagination=[],b.hasLoaded=!1,b.pages=[],b.$on("contentUpdated",function(){var a=b.currentPage*b.perPage-b.perPage,c=d.fetch(),e=Math.ceil(c.length/b.perPage);b.productCount=c.length,b.products=c.slice(a,b.perPage+a),b.hasLoaded=!0;for(var f=0;e>f;f++)b.pages[f]=f+1}),b.$on("switchedCategory",function(a,b){d.hasLoaded().then(function(){d.setCategoryId(b)})}),b.toggleColour=function(a){d.addRemoveById("colour",a)},b.toggleManufacturer=function(a){d.addRemoveById("manufacturer",a)}}])}(window.mao);